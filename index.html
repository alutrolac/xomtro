<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Inn Ultimate 5.0 | Pro Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;700&display=swap');
        :root { --primary: #6366f1; --secondary: #f43f5e; }
        body { font-family: 'Lexend', sans-serif; background: #f8fafc; color: #1e293b; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media print { .no-print { display: none; } .print-only { display: block; } body { background: white; } }
    </style>
</head>
<body class="bg-slate-50">

<div class="flex min-h-screen overflow-hidden">
    <aside class="no-print w-20 lg:w-64 bg-slate-900 text-slate-400 flex flex-col transition-all duration-300">
        <div class="p-6 text-white flex items-center space-x-3">
            <div class="bg-indigo-600 p-2 rounded-lg"><i class="fas fa-bolt text-xl"></i></div>
            <span class="text-xl font-bold hidden lg:inline tracking-tighter">Xóm Trọ Vui Vẻ <span class="text-indigo-500">5.0</span></span>
        </div>
        
        <nav class="flex-1 px-4 space-y-2 mt-4">
            <button onclick="switchTab('dash')" class="nav-link w-full flex items-center p-3 rounded-xl hover:bg-slate-800 hover:text-white transition group">
                <i class="fas fa-th-large w-6 text-center"></i> <span class="ml-3 hidden lg:inline">Tổng quan</span>
            </button>
            <button onclick="switchTab('rooms')" class="nav-link w-full flex items-center p-3 rounded-xl hover:bg-slate-800 hover:text-white transition">
                <i class="fas fa-door-open w-6 text-center"></i> <span class="ml-3 hidden lg:inline">Quản lý phòng</span>
            </button>
            <button onclick="switchTab('billing')" class="nav-link w-full flex items-center p-3 rounded-xl hover:bg-slate-800 hover:text-white transition">
                <i class="fas fa-file-invoice w-6 text-center"></i> <span class="ml-3 hidden lg:inline">Lập hóa đơn</span>
            </button>
            <button onclick="switchTab('history')" class="nav-link w-full flex items-center p-3 rounded-xl hover:bg-slate-800 hover:text-white transition">
                <i class="fas fa-history w-6 text-center"></i> <span class="ml-3 hidden lg:inline">Lịch sử thu tiền</span>
            </button>
            <button onclick="switchTab('settings')" class="nav-link w-full flex items-center p-3 rounded-xl hover:bg-slate-800 hover:text-white transition">
                <i class="fas fa-cog w-6 text-center"></i> <span class="ml-3 hidden lg:inline">Cấu hình giá</span>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-800">
            <button onclick="exportData()" class="w-full bg-slate-800 p-2 rounded-lg text-xs hover:bg-indigo-600 hover:text-white transition">
                <i class="fas fa-cloud-download-alt mr-1"></i> <span class="hidden lg:inline">Backup dữ liệu</span>
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-screen overflow-hidden">
        <header class="no-print h-16 bg-white border-b flex items-center justify-between px-8">
            <h2 id="tab-title" class="text-lg font-bold text-slate-700">Dashboard</h2>
            <div class="flex items-center space-x-4">
                <span id="live-clock" class="text-sm font-medium text-slate-500"></span>
                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold">A</div>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-4 md:p-8">
            
            <section id="tab-dash" class="tab-content active space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition"><i class="fas fa-home text-6xl"></i></div>
                        <p class="text-slate-500 text-sm font-medium">Tổng số phòng</p>
                        <h3 class="text-3xl font-bold mt-1" id="dash-total-rooms">0</h3>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <p class="text-emerald-500 text-sm font-medium">Đang cho thuê</p>
                        <h3 class="text-3xl font-bold mt-1 text-emerald-600" id="dash-occupied">0</h3>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <p class="text-rose-500 text-sm font-medium">Phòng đang trống</p>
                        <h3 class="text-3xl font-bold mt-1 text-rose-600" id="dash-empty">0</h3>
                    </div>
                    <div class="bg-indigo-600 p-6 rounded-2xl shadow-lg shadow-indigo-100 text-white">
                        <p class="text-indigo-100 text-sm font-medium">Doanh thu dự kiến</p>
                        <h3 class="text-3xl font-bold mt-1" id="dash-revenue">0đ</h3>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white p-6 rounded-2xl border">
                        <h4 class="font-bold mb-4">Biểu đồ công suất phòng (%)</h4>
                        <canvas id="occupancyChart" height="200"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border">
                        <h4 class="font-bold mb-4 italic text-indigo-600">Thông báo nhanh</h4>
                        <div id="quick-alerts" class="space-y-3 text-sm">
                            </div>
                    </div>
                </div>
            </section>

            <section id="tab-rooms" class="tab-content space-y-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div class="flex bg-white rounded-xl p-1 shadow-sm border w-fit">
                        <button onclick="filterRooms('all')" class="px-4 py-2 rounded-lg text-sm font-medium hover:bg-slate-100">Tất cả</button>
                        <button onclick="filterRooms('Available')" class="px-4 py-2 rounded-lg text-sm font-medium text-rose-600 hover:bg-rose-50">Phòng trống</button>
                        <button onclick="filterRooms('Occupied')" class="px-4 py-2 rounded-lg text-sm font-medium text-indigo-600 hover:bg-indigo-50">Đã thuê</button>
                    </div>
                    <button onclick="openRoomModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-indigo-100 hover:bg-indigo-700 flex items-center">
                        <i class="fas fa-plus mr-2"></i> THÊM PHÒNG MỚI
                    </button>
                </div>
                <div id="room-list-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    </div>
            </section>

            <section id="tab-billing" class="tab-content">
                <div class="max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-8 rounded-3xl border shadow-sm space-y-6">
                        <h3 class="text-xl font-bold border-b pb-4">Lập hóa đơn</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="text-xs font-bold uppercase text-slate-400">Chọn phòng khách thuê</label>
                                <select id="bill-room-id" onchange="syncRoomInfo()" class="w-full p-4 mt-1 bg-slate-50 border rounded-2xl outline-none focus:ring-2 ring-indigo-500"></select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs font-bold uppercase text-slate-400">Số Điện mới</label>
                                    <input type="number" id="bill-e-new" class="w-full p-4 mt-1 border rounded-2xl focus:ring-2 ring-indigo-500 outline-none" placeholder="0">
                                    <p class="text-[10px] mt-1 text-slate-400 italic">Cũ: <span id="bill-e-old">0</span></p>
                                </div>
                                <div>
                                    <label class="text-xs font-bold uppercase text-slate-400">Số Nước mới</label>
                                    <input type="number" id="bill-w-new" class="w-full p-4 mt-1 border rounded-2xl focus:ring-2 ring-indigo-500 outline-none" placeholder="0">
                                    <p class="text-[10px] mt-1 text-slate-400 italic">Cũ: <span id="bill-w-old">0</span></p>
                                </div>
                            </div>
                            <div>
                                <label class="text-xs font-bold uppercase text-slate-400">Phí khác (Internet/Rác...)</label>
                                <input type="number" id="bill-others" class="w-full p-4 mt-1 border rounded-2xl outline-none" value="0">
                            </div>
                            <button onclick="processInvoice()" class="w-full bg-slate-900 text-white py-5 rounded-2xl font-bold text-lg shadow-xl hover:bg-indigo-600 transition-all">
                                XUẤT HÓA ĐƠN & LƯU CHỈ SỐ
                            </button>
                        </div>
                    </div>

                    <div id="invoice-result-area" class="hidden">
                        <div id="invoice-capture" class="bg-[#fffef0] p-8 border border-slate-200 rounded-sm shadow-2xl relative">
                            <div class="absolute top-0 right-0 p-4 opacity-20"><i class="fas fa-file-invoice-dollar text-6xl"></i></div>
                            <h2 class="text-center font-black text-2xl uppercase tracking-widest text-slate-800">Hóa Đơn Tiền Nhà</h2>
                            <p id="inv-date" class="text-center text-xs text-slate-500 mb-8 font-medium"></p>
                            
                            <div class="flex justify-between font-bold text-lg mb-6 bg-slate-100 p-3 rounded-lg">
                                <span>PHÒNG: <span id="inv-room-name">---</span></span>
                                <span>KHÁCH: <span id="inv-tenant">---</span></span>
                            </div>

                            <div class="space-y-3 mb-10" id="inv-rows">
                                </div>

                            <div class="flex justify-between items-center border-t-4 border-double border-slate-800 pt-6">
                                <img id="inv-qr" src="" class="w-32 h-32 border bg-white p-1 rounded">
                                <div class="text-right">
                                    <p class="text-xs font-bold text-slate-500 uppercase">Tổng tiền thanh toán</p>
                                    <p id="inv-grand-total" class="text-3xl font-black text-indigo-700"></p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 flex gap-2 no-print">
                            <button onclick="window.print()" class="flex-1 bg-white border p-3 rounded-xl font-bold hover:bg-slate-50">TẢI PDF / IN</button>
                            <button onclick="copyInvoiceText()" class="flex-1 bg-indigo-100 text-indigo-700 p-3 rounded-xl font-bold">COPY TIN NHẮN</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="tab-history" class="tab-content">
                <div class="bg-white rounded-3xl border overflow-hidden shadow-sm">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 border-b">
                            <tr>
                                <th class="p-4 font-bold text-slate-600 uppercase text-xs">Ngày tháng</th>
                                <th class="p-4 font-bold text-slate-600 uppercase text-xs">Phòng</th>
                                <th class="p-4 font-bold text-slate-600 uppercase text-xs">Tổng tiền</th>
                                <th class="p-4 font-bold text-slate-600 uppercase text-xs">Chi tiết</th>
                            </tr>
                        </thead>
                        <tbody id="history-list" class="divide-y">
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="tab-settings" class="tab-content">
                <div class="max-w-2xl bg-white p-8 rounded-3xl border shadow-sm">
                    <h3 class="text-xl font-bold mb-6">Cấu hình hệ thống</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 mb-2 uppercase">Giá Điện (1kWh)</label>
                            <input type="number" id="cfg-e-price" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none" value="3500">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-400 mb-2 uppercase">Giá Nước (1m3)</label>
                            <input type="number" id="cfg-w-price" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none" value="15000">
                        </div>
                        <div class="md:col-span-2">
                            <h4 class="font-bold border-t pt-4 mt-2">Thông tin nhận tiền (QR)</h4>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-400 mb-2 uppercase">Ngân hàng</label>
                            <input type="text" id="cfg-bank-name" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none" value="MBBank">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-400 mb-2 uppercase">Số tài khoản</label>
                            <input type="text" id="cfg-bank-no" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none" value="0912345678">
                        </div>
                    </div>
                    <button onclick="saveSettings()" class="mt-8 bg-indigo-600 text-white px-8 py-4 rounded-2xl font-bold shadow-lg shadow-indigo-100 hover:bg-indigo-700">LƯU CÀI ĐẶT</button>
                </div>
            </section>
        </div>
    </main>
</div>

<div id="modal-room" class="fixed inset-0 bg-slate-900/60 hidden flex items-center justify-center p-4 z-50 backdrop-blur-sm">
    <div class="bg-white rounded-3xl w-full max-w-lg shadow-2xl overflow-hidden animate-fadeIn">
        <div class="p-6 border-b flex justify-between items-center">
            <h3 class="text-xl font-bold">Cài đặt phòng trọ</h3>
            <button onclick="closeRoomModal()" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times"></i></button>
        </div>
        <div class="p-8 space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <input type="text" id="m-name" placeholder="Tên phòng (VD: 101)" class="w-full p-4 border rounded-2xl outline-none focus:ring-2 ring-indigo-500">
                <input type="number" id="m-price" placeholder="Giá thuê mặc định" class="w-full p-4 border rounded-2xl outline-none">
            </div>
            <input type="text" id="m-tenant" placeholder="Tên khách thuê (Bỏ trống nếu chưa có)" class="w-full p-4 border rounded-2xl outline-none">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase">Chỉ số Điện ban đầu</label>
                    <input type="number" id="m-e-start" class="w-full p-4 mt-1 border rounded-2xl">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase">Chỉ số Nước ban đầu</label>
                    <input type="number" id="m-w-start" class="w-full p-4 mt-1 border rounded-2xl">
                </div>
            </div>
            <button onclick="saveRoom()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold text-lg">XÁC NHẬN LƯU</button>
        </div>
    </div>
</div>

<script>
    // CORE DATA & STATE
    let db = JSON.parse(localStorage.getItem('smart_inn_pro_v5')) || {
        rooms: [],
        history: [],
        settings: {
            ePrice: 3500,
            wPrice: 15000,
            bankName: "MB",
            bankNo: "0912345678",
            bankOwner: "NGUYEN VAN A"
        }
    };

    let chartInstance = null;

    // INITIALIZATION
    window.onload = () => {
        updateClock();
        setInterval(updateClock, 1000);
        refreshUI();
    };

    function updateClock() {
        document.getElementById('live-clock').innerText = new Date().toLocaleString('vi-VN');
    }

    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        document.getElementById('tab-title').innerText = tabId.charAt(0).toUpperCase() + tabId.slice(1);
        refreshUI();
    }

    // CRUD ROOMS
    function openRoomModal() { document.getElementById('modal-room').classList.remove('hidden'); }
    function closeRoomModal() { document.getElementById('modal-room').classList.add('hidden'); }

    function saveRoom() {
        const name = document.getElementById('m-name').value;
        const price = Number(document.getElementById('m-price').value);
        const tenant = document.getElementById('m-tenant').value;
        const eStart = Number(document.getElementById('m-e-start').value || 0);
        const wStart = Number(document.getElementById('m-w-start').value || 0);

        if(!name || !price) return alert("Vui lòng điền tên phòng và giá!");

        db.rooms.push({
            id: Date.now(),
            name, price, tenant,
            eOld: eStart, wOld: wStart,
            status: tenant ? 'Occupied' : 'Available'
        });

        saveDB();
        closeRoomModal();
        refreshUI();
    }

    function deleteRoom(id) {
        if(confirm('Xóa phòng này dữ liệu sẽ không thể khôi phục?')) {
            db.rooms = db.rooms.filter(r => r.id !== id);
            saveDB();
            refreshUI();
        }
    }

    // BILLING LOGIC
    function syncRoomInfo() {
        const rid = document.getElementById('bill-room-id').value;
        const room = db.rooms.find(r => r.id == rid);
        if(room) {
            document.getElementById('bill-e-old').innerText = room.eOld;
            document.getElementById('bill-w-old').innerText = room.wOld;
        }
    }

    function processInvoice() {
        const rid = document.getElementById('bill-room-id').value;
        const room = db.rooms.find(r => r.id == rid);
        const eNew = Number(document.getElementById('bill-e-new').value);
        const wNew = Number(document.getElementById('bill-w-new').value);
        const others = Number(document.getElementById('bill-others').value || 0);

        if(eNew < room.eOld || wNew < room.wOld) return alert("Chỉ số mới không được nhỏ hơn chỉ số cũ!");

        const eUsed = eNew - room.eOld;
        const wUsed = wNew - room.wOld;
        const eMoney = eUsed * db.settings.ePrice;
        const wMoney = wUsed * db.settings.wPrice;
        const total = room.price + eMoney + wMoney + others;

        // Render Invoice
        document.getElementById('inv-room-name').innerText = room.name;
        document.getElementById('inv-tenant').innerText = room.tenant;
        document.getElementById('inv-date').innerText = new Date().toLocaleDateString('vi-VN');
        document.getElementById('inv-grand-total').innerText = total.toLocaleString() + " VNĐ";
        
        document.getElementById('inv-rows').innerHTML = `
            <div class="flex justify-between"><span>Tiền phòng:</span> <b>${room.price.toLocaleString()}đ</b></div>
            <div class="flex justify-between border-t border-slate-200 pt-2">
                <span>Điện: (${eNew} - ${room.eOld}) x ${db.settings.ePrice}</span>
                <b>${eMoney.toLocaleString()}đ</b>
            </div>
            <div class="flex justify-between border-t border-slate-200 pt-2">
                <span>Nước: (${wNew} - ${room.wOld}) x ${db.settings.wPrice}</span>
                <b>${wMoney.toLocaleString()}đ</b>
            </div>
            ${others > 0 ? `<div class="flex justify-between border-t border-slate-200 pt-2"><span>Phí khác:</span> <b>${others.toLocaleString()}đ</b></div>` : ''}
        `;

        // QR Code API
        const qrUrl = `https://img.vietqr.io/image/${db.settings.bankName}-${db.settings.bankNo}-compact2.png?amount=${total}&addInfo=Tien%20Phong%20${room.name}&accountName=${encodeURIComponent(db.settings.bankOwner)}`;
        document.getElementById('inv-qr').src = qrUrl;

        document.getElementById('invoice-result-area').classList.remove('hidden');

        // Save to History & Update Room
        db.history.unshift({ date: new Date().toLocaleString(), room: room.name, total: total });
        room.eOld = eNew;
        room.wOld = wNew;
        saveDB();
    }

    // UI REFRESH
    function refreshUI() {
        renderDashboard();
        renderRoomList();
        renderHistory();
        
        // Load settings to inputs
        document.getElementById('cfg-e-price').value = db.settings.ePrice;
        document.getElementById('cfg-w-price').value = db.settings.wPrice;
        document.getElementById('cfg-bank-name').value = db.settings.bankName;
        document.getElementById('cfg-bank-no').value = db.settings.bankNo;

        // Fill Select in Billing
        const select = document.getElementById('bill-room-id');
        const occupiedRooms = db.rooms.filter(r => r.status === 'Occupied');
        select.innerHTML = occupiedRooms.map(r => `<option value="${r.id}">${r.name} - ${r.tenant}</option>`).join('');
        if(occupiedRooms.length > 0) syncRoomInfo();
    }

    function renderDashboard() {
        const total = db.rooms.length;
        const occupied = db.rooms.filter(r => r.status === 'Occupied').length;
        const revenue = db.rooms.filter(r => r.status === 'Occupied').reduce((sum, r) => sum + r.price, 0);

        document.getElementById('dash-total-rooms').innerText = total;
        document.getElementById('dash-occupied').innerText = occupied;
        document.getElementById('dash-empty').innerText = total - occupied;
        document.getElementById('dash-revenue').innerText = revenue.toLocaleString() + "đ";

        initChart(occupied, total - occupied);
    }

    function renderRoomList(filter = 'all') {
        const container = document.getElementById('room-list-container');
        let list = db.rooms;
        if(filter !== 'all') list = db.rooms.filter(r => r.status === filter);

        container.innerHTML = list.map(r => `
            <div class="bg-white p-6 rounded-3xl border shadow-sm hover:shadow-md transition">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h4 class="text-2xl font-black text-slate-800">${r.name}</h4>
                        <p class="text-sm text-slate-500 font-medium">${r.tenant || '⚠️ Đang trống'}</p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-[10px] font-bold ${r.status === 'Occupied' ? 'bg-indigo-100 text-indigo-700' : 'bg-rose-100 text-rose-700'}">
                        ${r.status === 'Occupied' ? 'ĐÃ THUÊ' : 'TRỐNG'}
                    </span>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <div class="bg-slate-50 p-3 rounded-2xl">
                        <p class="text-[10px] uppercase font-bold text-slate-400">Giá thuê</p>
                        <p class="font-bold">${r.price.toLocaleString()}đ</p>
                    </div>
                    <div class="bg-slate-50 p-3 rounded-2xl">
                        <p class="text-[10px] uppercase font-bold text-slate-400">Chỉ số điện</p>
                        <p class="font-bold">${r.eOld} <span class="text-xs font-normal">kWh</span></p>
                    </div>
                </div>
                <div class="mt-6 flex gap-2">
                    <button onclick="deleteRoom(${r.id})" class="flex-1 bg-rose-50 text-rose-600 p-3 rounded-xl hover:bg-rose-600 hover:text-white transition"><i class="fas fa-trash"></i></button>
                    <button class="flex-[3] bg-slate-900 text-white p-3 rounded-xl font-bold">CHI TIẾT</button>
                </div>
            </div>
        `).join('');
    }

    function renderHistory() {
        const container = document.getElementById('history-list');
        container.innerHTML = db.history.map(h => `
            <tr class="hover:bg-slate-50 transition">
                <td class="p-4 text-sm">${h.date}</td>
                <td class="p-4 font-bold text-indigo-600">${h.room}</td>
                <td class="p-4 font-black">${h.total.toLocaleString()}đ</td>
                <td class="p-4"><i class="fas fa-check-circle text-emerald-500"></i> Thành công</td>
            </tr>
        `).join('');
    }

    function initChart(occ, empty) {
        const ctx = document.getElementById('occupancyChart');
        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Đã thuê', 'Trống'],
                datasets: [{
                    data: [occ, empty],
                    backgroundColor: ['#6366f1', '#f43f5e'],
                    borderWidth: 0,
                    cutout: '80%'
                }]
            },
            options: { plugins: { legend: { position: 'bottom' } } }
        });
    }

    function saveSettings() {
        db.settings.ePrice = Number(document.getElementById('cfg-e-price').value);
        db.settings.wPrice = Number(document.getElementById('cfg-w-price').value);
        db.settings.bankName = document.getElementById('cfg-bank-name').value;
        db.settings.bankNo = document.getElementById('cfg-bank-no').value;
        saveDB();
        alert("Đã lưu cài đặt!");
    }

    function saveDB() { localStorage.setItem('smart_inn_pro_v5', JSON.stringify(db)); }
    
    function exportData() {
        const blob = new Blob([JSON.stringify(db)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Backup_Inn_Pro_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
    }
</script>

</body>
</html>
