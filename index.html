<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xóm Trọ Vui Vẻ - Quản Lý Khách Thuê</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f4f7fe; }
        .glass-card { background: white; border-radius: 30px; border: 1px solid #e2e8f0; }
        .sidebar-active { background: #4318FF; color: white; box-shadow: 0 10px 20px rgba(67, 24, 255, 0.3); }
        .avatar-circle { width: 45px; height: 45px; border-radius: 15px; background: #4318FF; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="flex min-h-screen">

<aside class="no-print w-80 bg-white h-screen sticky top-0 p-8 flex flex-col border-r border-slate-100">
    <div class="flex items-center space-x-3 mb-12 px-2">
        <div class="w-10 h-10 bg-[#4318FF] rounded-xl flex items-center justify-center text-white"><i class="fas fa-heart"></i></div>
        <span class="text-2xl font-black text-[#1B2559]">Xóm Trọ <span class="text-blue-600">VV</span></span>
    </div>
    <nav class="flex-grow space-y-2">
        <button onclick="nav('dash')" id="n-dash" class="sidebar-active w-full flex items-center space-x-4 p-4 rounded-2xl font-bold transition"><i class="fas fa-chart-pie"></i><span>Tổng quan</span></button>
        <button onclick="nav('rooms')" id="n-rooms" class="w-full flex items-center space-x-4 p-4 rounded-2xl font-bold text-slate-400 hover:bg-slate-50 transition"><i class="fas fa-door-open"></i><span>Phòng trọ</span></button>
        <button onclick="nav('tenants')" id="n-tenants" class="w-full flex items-center space-x-4 p-4 rounded-2xl font-bold text-slate-400 hover:bg-slate-50 transition"><i class="fas fa-users"></i><span>Khách thuê</span></button>
        <button onclick="nav('billing')" id="n-billing" class="w-full flex items-center space-x-4 p-4 rounded-2xl font-bold text-slate-400 hover:bg-slate-50 transition"><i class="fas fa-receipt"></i><span>Hóa đơn</span></button>
    </nav>
</aside>

<main class="flex-grow p-10 overflow-y-auto">
    <section id="s-dash" class="tab-content space-y-8">
        <h2 class="text-3xl font-extrabold">Bảng điều khiển</h2>
        <div class="grid grid-cols-3 gap-6">
            <div class="glass-card p-8 text-center"><p class="text-slate-400 font-bold uppercase text-xs">Tổng số khách</p><h3 id="stat-tenant-count" class="text-4xl font-black mt-2">0</h3></div>
            <div class="glass-card p-8 text-center"><p class="text-slate-400 font-bold uppercase text-xs">Đã nộp CCCD</p><h3 id="stat-id-count" class="text-4xl font-black mt-2 text-green-500">0</h3></div>
            <div class="glass-card p-8 text-center"><p class="text-slate-400 font-bold uppercase text-xs">Hợp đồng sắp hết</p><h3 class="text-4xl font-black mt-2 text-orange-500">2</h3></div>
        </div>
    </section>

    <section id="s-tenants" class="tab-content hidden space-y-6">
        <div class="flex justify-between items-center">
            <h2 class="text-3xl font-extrabold">Danh sách khách thuê</h2>
            <div class="relative">
                <input type="text" placeholder="Tìm tên khách..." class="pl-10 pr-4 py-3 rounded-2xl border-none bg-white shadow-sm outline-none w-64 focus:ring-2 focus:ring-blue-500">
                <i class="fas fa-search absolute left-4 top-4 text-slate-300"></i>
            </div>
        </div>

        <div class="glass-card overflow-hidden shadow-sm">
            <table class="w-full text-left border-collapse">
                <thead class="bg-slate-50 border-b border-slate-100">
                    <tr>
                        <th class="p-6 text-xs font-black uppercase text-slate-400">Khách hàng</th>
                        <th class="p-6 text-xs font-black uppercase text-slate-400">Số phòng</th>
                        <th class="p-6 text-xs font-black uppercase text-slate-400">Số điện thoại</th>
                        <th class="p-6 text-xs font-black uppercase text-slate-400">Hồ sơ CCCD</th>
                        <th class="p-6 text-xs font-black uppercase text-slate-400">Trạng thái</th>
                        <th class="p-6 text-xs font-black uppercase text-slate-400 text-right">Thao tác</th>
                    </tr>
                </thead>
                <tbody id="tenantTable" class="divide-y divide-slate-50">
                    </tbody>
            </table>
        </div>
    </section>

    <section id="s-rooms" class="tab-content hidden"><h2 class="text-2xl font-bold">Quản lý phòng trọ...</h2></section>
    <section id="s-billing" class="tab-content hidden"><h2 class="text-2xl font-bold">Quản lý hóa đơn...</h2></section>
</main>

<div id="m-id-view" class="hidden fixed inset-0 z-[2000] bg-black/80 backdrop-blur-md flex items-center justify-center p-10">
    <div class="max-w-4xl w-full space-y-4">
        <div class="flex justify-between text-white font-bold">
            <h3 id="id-view-title">Hồ sơ khách thuê</h3>
            <button onclick="closeModal('m-id-view')" class="text-2xl">&times;</button>
        </div>
        <div class="grid grid-cols-2 gap-6">
            <div class="bg-white p-2 rounded-2xl shadow-2xl">
                <p class="text-xs font-bold text-center py-2 uppercase">Mặt trước</p>
                <img id="view-id-f" src="https://via.placeholder.com/400x250?text=Mat+Truoc" class="w-full rounded-xl">
            </div>
            <div class="bg-white p-2 rounded-2xl shadow-2xl">
                <p class="text-xs font-bold text-center py-2 uppercase">Mặt sau</p>
                <img id="view-id-b" src="https://via.placeholder.com/400x250?text=Mat+Sau" class="w-full rounded-xl">
            </div>
        </div>
    </div>
</div>

<script>
    // Dữ liệu giả lập (Lấy từ localStorage của bạn)
    let rooms = JSON.parse(localStorage.getItem('xtvv_v6_rooms')) || [];
    
    function nav(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
        document.getElementById('s-'+id).classList.remove('hidden');
        document.querySelectorAll('aside button').forEach(b => b.classList.remove('sidebar-active', 'text-white'));
        document.getElementById('n-'+id).classList.add('sidebar-active');
        if(id === 'tenants') renderTenants();
        if(id === 'dash') updateStats();
    }

    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

    function updateStats() {
        const tenants = rooms.filter(r => r.tenant !== '');
        document.getElementById('stat-tenant-count').innerText = tenants.length;
        document.getElementById('stat-id-count').innerText = tenants.filter(t => t.idCardF).length;
    }

    function renderTenants() {
        const tenantList = rooms.filter(r => r.tenant !== '');
        const html = tenantList.map(r => `
            <tr class="hover:bg-slate-50 transition">
                <td class="p-6">
                    <div class="flex items-center space-x-3">
                        <div class="avatar-circle">${r.tenant.charAt(0)}</div>
                        <div>
                            <p class="font-bold text-[#1B2559]">${r.tenant}</p>
                            <p class="text-xs text-slate-400">Tham gia: 01/01/2026</p>
                        </div>
                    </div>
                </td>
                <td class="p-6"><span class="font-black text-blue-600">P.${r.no}</span></td>
                <td class="p-6 font-medium">${r.phone || '090.xxx.xxxx'}</td>
                <td class="p-6">
                    <button onclick="viewID('${r.tenant}', '${r.idCardF}', '${r.idCardB}')" 
                        class="px-4 py-2 rounded-xl text-xs font-bold ${r.idCardF ? 'bg-green-100 text-green-600' : 'bg-slate-100 text-slate-400'}">
                        <i class="fas fa-id-card mr-2"></i> ${r.idCardF ? 'XEM ẢNH' : 'THIẾU ẢNH'}
                    </button>
                </td>
                <td class="p-6">
                    <span class="px-3 py-1 bg-blue-100 text-blue-600 rounded-lg text-[10px] font-black uppercase">Đang ở</span>
                </td>
                <td class="p-6 text-right">
                    <button class="text-slate-300 hover:text-blue-600 p-2"><i class="fas fa-edit"></i></button>
                    <button class="text-slate-300 hover:text-red-500 p-2"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
        document.getElementById('tenantTable').innerHTML = html || '<tr><td colspan="6" class="p-10 text-center text-slate-400">Chưa có khách thuê nào</td></tr>';
    }

    function viewID(name, front, back) {
        document.getElementById('id-view-title').innerText = "Hồ sơ CCCD: " + name;
        if(front && front !== "null") document.getElementById('view-id-f').src = front;
        if(back && back !== "null") document.getElementById('view-id-b').src = back;
        document.getElementById('m-id-view').classList.remove('hidden');
    }

    // Khởi tạo
    updateStats();
</script>
</body>
</html>
